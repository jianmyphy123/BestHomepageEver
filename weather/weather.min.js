(function(e){"use strict";function t(e,t){var n=new Date;n.setTime(n.getTime()+31536e7),document.cookie=e+"="+t+"; expires="+n.toUTCString()}function n(e,t){for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var r=n[i].trim().split("=");if(r[0]===e)return r[1]}return t}function i(t,r){var a=n("weather_city","");return a?t({city:a}):!r&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t({lat:e.coords.latitude,lon:e.coords.longitude},!0)},function(e){i(t,!0)}):void e.getJSON("http://ipinfo.io",function(e){var n=e.loc.split(",");t({lat:parseFloat(n[0]),lon:parseFloat(n[1])})})}function r(t,i,r){t.units=n("weather_units","imperial"),e.getJSON("../weather/weather.php",t,function(e){e&&e.ok?i(e):r instanceof Function&&r()})}function a(t){function i(e){var t="24"===n("weather_timeformat","12"),i="";return t||(i=e.getHours()>=12?" PM":" AM",e.getHours()>12&&e.setTime(e.getTime()-432e5)),(t&&e.getHours()<10?"0":"")+e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes()+i}function r(e){var t=e.icon?'<img src="'+a(e.icon)+'" />':"";return"<h4>"+t+"<strong>"+e.day+"</strong>: High: "+Math.round(e.max_temp)+"&deg; Low: "+Math.round(e.min_temp)+"&deg;</h4>"}function a(e){return"http://openweathermap.org/img/w/"+e+".png"}e(".weather_temp").html(Math.round(t.temp)+"&deg;"),e(".weather_city").text(t.city.name+", "+t.city.country),e(".weather_sunrise").text(i(new Date(1e3*t.sunrise))),e(".weather_sunset").text(i(new Date(1e3*t.sunset))),t.desc&&e(".weather_desc").text(t.desc),t.icon&&e(".weather_icon").attr("src",a(t.icon));for(var o="",c=0;c<t.forecast.length&&5>c;c++)o+=r(t.forecast[c]);e("#weather_forecast").html(o)}function o(){e("#weather_search_info").text("Loading..."),r({name:encodeURIComponent(e("#weather_search").val())},function(t){a(t),h=t.city.id,e("#weather_city_save").text("Save City"),e("#weather_search_info").text("")},function(){e("#weather_search_info").text("Failed to load weather report")})}function c(){i(function(e,i){r(e,function(e){var r=n("weather_city","");r||i||t("weather_city",e.city.id),a(e)},function(){console.log("Could not get weather")})})}var h=-1;e("#weather_search").on("keypress",function(e){13===e.which&&o()}),e("#weather_search_button").on("click",function(){o()}),e("#weather_city_save").on("click",function(){return-1!==h?(t("weather_city",h),h=-1,void e("#weather_city_save").text("Reset City")):(t("weather_city",""),void c())}),c(),e("metric"===n("weather_units","imperial")?"#weather_celsius":"#weather_fahrenheit").prop("checked",!0),e("input[type=radio][name=weather_units]").change(function(){("metric"===this.value||"imperial"===this.value)&&t("weather_units",this.value)}),e("24"===n("weather_timeformat","12")?"#weather_24":"#weather_12").prop("checked",!0),e("input[type=radio][name=weather_timeformat]").change(function(){("12"===this.value||"24"===this.value)&&t("weather_timeformat",this.value)})}).call(this,jQuery);